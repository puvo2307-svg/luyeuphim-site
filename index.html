<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√¨nh ph√°t phim - Lu Y√™u Phim</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; text-align: center; background: #121212; color: white; padding: 15px; margin: 0; }
        
        /* Th√¥ng b√°o c·∫•m PC */
        #pc-blocked {
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n, hi·ªán ra n·∫øu l√† PC */
            height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        #pc-blocked h1 { color: #ee4d2d; }

        /* N·ªôi dung ch√≠nh */
        #mobile-content {
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n, hi·ªán ra n·∫øu l√† Mobile */
            max-width: 900px;
            margin: 0 auto;
        }
        
        /* Player Container */
        .player-container { 
            position: relative; 
            width: 100%; 
            background: #000;
            aspect-ratio: 16/9;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        iframe { width: 100%; height: 100%; border: none; }
        
        /* Overlay - L·ªõp ph·ªß */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 99; cursor: pointer;
            padding: 20px; box-sizing: border-box;
        }
        .btn-shopee-main {
            background: linear-gradient(135deg, #ff5722 0%, #ee4d2d 100%);
            color: white; border: none; padding: 18px 35px;
            font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer;
            box-shadow: 0 8px 15px rgba(238, 77, 45, 0.4);
            text-transform: uppercase; letter-spacing: 1px;
        }

        /* Episode List */
        .episode-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px; padding: 15px;
            background: #1e1e1e; border-radius: 15px;
        }
        .ep-item {
            background: #333; color: #ccc; border: 1px solid #444;
            padding: 12px 5px; cursor: pointer; border-radius: 8px;
            font-weight: 500; font-size: 14px;
        }
        .ep-item.active { background: #ee4d2d; color: white; border-color: #ee4d2d; font-weight: bold; }
        .ep-item.uploading { background: #222; color: #555; border: 1px dashed #444; cursor: not-allowed; }

        .text-support { color: #f1c40f; font-size: 16px; margin-bottom: 15px; font-weight: 500; }
        .text-note { color: #777; font-size: 13px; margin-top: 15px; line-height: 1.4; }

        /* √î t√¨m ki·∫øm phim */
        .search-container {
            margin-bottom: 16px;
            text-align: left;
        }
        .search-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        .search-desc {
            font-size: 13px;
            color: #bbb;
            margin-bottom: 8px;
        }
        .search-input {
            width: 100%;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #1b1b1b;
            color: #eee;
            font-size: 14px;
            box-sizing: border-box;
        }
        .search-results {
            margin-top: 6px;
            max-height: 160px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #333;
            background: #181818;
        }
        .search-result-item {
            padding: 6px 10px;
            font-size: 13px;
            cursor: pointer;
            border-bottom: 1px solid #222;
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
        .search-result-item:hover {
            background: #262626;
        }

        /* N√∫t li√™n k·∫øt d∆∞·ªõi th√¥ng b√°o / d∆∞·ªõi player */
        .link-buttons {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .link-btn {
            padding: 8px 14px;
            border-radius: 999px;
            border: 1px solid #333;
            background: #1e1e1e;
            color: #f5f5f5;
            font-size: 13px;
            cursor: pointer;
            text-decoration: none;
            white-space: nowrap;
        }
        .link-btn:hover {
            background: #333;
        }
        .link-btn-primary {
            border-color: #ee4d2d;
            background: #ee4d2d;
        }
        .link-btn-primary:hover {
            background: #ff6a3a;
        }

        /* Popup donate ƒë·∫πp h∆°n */
        .donate-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .donate-modal {
            background: #181818;
            border-radius: 12px;
            padding: 18px 20px;
            border: 1px solid #333;
            max-width: 320px;
            width: 90%;
            text-align: left;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            font-size: 14px;
        }
        .donate-modal-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #f1c40f;
        }
        .donate-modal-close {
            margin-top: 14px;
            width: 100%;
            padding: 8px 0;
            border-radius: 8px;
            border: none;
            background: #ee4d2d;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        /* Khung donate */
        .donate-box {
            margin-top: 18px;
            padding: 12px 14px;
            background: #181818;
            border-radius: 10px;
            border: 1px solid #333;
            font-size: 13px;
            text-align: left;
        }
        .donate-text-title {
            font-weight: 600;
            color: #f1c40f;
            margin-bottom: 4px;
        }
        .donate-text-sub {
            color: #aaa;
            line-height: 1.4;
        }
        /* N√∫t Shopee b√™n ngo√†i (kh√¥ng che player) */
        .shopee-cta {
            margin: 12px 0 4px 0;
            display: inline-block;
            background: #ee4d2d;
            color: #fff;
            padding: 10px 18px;
            border-radius: 999px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(238, 77, 45, 0.4);
        }
        .shopee-cta:hover {
            background: #ff6a3a;
        }
    </style>
</head>
<body>

    <!-- M√†n h√¨nh ch·∫∑n PC -->
    <div id="pc-blocked">
        <h1>‚ö†Ô∏è TH√îNG B√ÅO</h1>
        <p>N·ªôi dung n√†y hi·ªán ch·ªâ h·ªó tr·ª£ xem tr√™n <strong>Thi·∫øt b·ªã di ƒë·ªông (Mobile)</strong>.</p>
        <div style="margin-top: 20px; color: #555;">(H·ªó tr·ª£: Android, iPhone, iPad)</div>

        <!-- C√°c n√∫t li√™n k·∫øt c·ªông ƒë·ªìng (PC) -->
        <div class="link-buttons">
            <a class="link-btn" href="https://www.facebook.com/groups/luyeuphim" target="_blank" rel="noopener noreferrer">
                Tham gia nh√≥m Fanpage
            </a>
            <a class="link-btn" href="https://youtube.com/channel/UCb35SXg3vJeYP5povmGHA1A?sub_confirmation=1" target="_blank" rel="noopener noreferrer">
                Theo d√µi &amp; nh·∫•n chu√¥ng YTB
            </a>
            <button class="link-btn-primary link-btn" onclick="showDonateInfo()">
                Donate duy tr√¨ k√™nh
            </button>
        </div>
        <!-- Ghi ch√∫ mi·ªÖn tr·ª´ tr√°ch nhi·ªám (PC) -->
        <div style="max-width: 900px; margin: 20px auto 0 auto; font-size: 12px; color: #888; text-align: left; padding: 0 12px;">
            <strong>L∆∞u √Ω:</strong> Ph·∫ßn d·ªãch + l·ªìng ti·∫øng (AI) t·∫°o b·ªüi team Lu Y√™u Phim. Video g·ªëc l·∫•y t·ª´ c√°c ngu·ªìn ph·ªï bi·∫øn tr√™n Internet. N·∫øu b·∫°n cho r·∫±ng quy·ªÅn l·ª£i b·ªã ·∫£nh h∆∞·ªüng, vui l√≤ng li√™n h·ªá ƒë·ªÉ g·ª°. Email: <strong>pu.truong.2307@gmail.com</strong>
        </div>
    </div>

    <!-- M√†n h√¨nh n·ªôi dung cho Mobile -->
    <div id="mobile-content">
        <!-- T√¨m ki·∫øm phim theo "T√™n Phim Vi·ªát" trong Google Sheet -->
        <div class="search-container">
            <div class="search-title">T√¨m phim theo t√™n ti·∫øng Vi·ªát</div>
            <div class="search-desc">
                Nh·∫≠p <strong>t√™n phim</strong> gi·ªëng nh∆∞ m√¥ t·∫£ tr√™n Fanpage/TikTok m√† b·∫°n ƒë√£ xem. V√≠ d·ª•: <em>"Ch√†ng Trai Xuy√™n Kh√¥ng X√¢y D·ª±ng ƒê·∫ø Ch·∫ø B·ªã V·ª£ C·∫Øm S·ª´ng C∆∞·ªõp C√¥ng V√† C√°i K·∫øt L√†m Ch·ªìng N·ªØ ƒê·∫ø"</em>
            </div>
            <input id="search-input" class="search-input" type="text" placeholder="Nh·∫≠p T√™n Phim Vi·ªát ƒë·ªÉ t√¨m..." autocomplete="off" />
            <div id="search-results" class="search-results" style="display:none;"></div>
        </div>

        <h2 id="film-title" style="font-size: 20px;">T·∫≠p 1 - T√™n Phim C·ªßa B·∫°n</h2>

        <div class="player-container">
            <!-- Overlay Shopee che player, b·∫•m ƒë·ªÉ m·ªü Shopee r·ªìi xem -->
            <div id="overlay" onclick="handlePlay()">
                <p class="text-support">·ª¶ng h·ªô chi ph√≠ duy tr√¨ v√† v·∫≠n h√†nh k√™nh Lu Y√™u Phim</p>
                <button class="btn-shopee-main">üõí M·ªû SHOPEE & XEM PHIM</button>
                <p class="text-note">(Xin l·ªói n·∫øu overlay xu·∫•t hi·ªán nhi·ªÅu; ƒë√¢y l√† m·ªôt ph·∫ßn chi ph√≠ duy tr√¨ k√™nh. App Shopee s·∫Ω m·ªü ·ªü tab m·ªõi, b·∫°n c√≥ th·ªÉ quay l·∫°i ƒë√¢y sau khi ho√†n t·∫•t.)</p>
            </div>

            <iframe id="video-player"
                src="https://geo.dailymotion.com/player.html?video=x9vxtfe&autoplay=0&mute=1" 
                allow="fullscreen" allowfullscreen>
            </iframe>
        </div>

        <div class="episode-list">
            <!-- Kh·ªõp v·ªõi d·ªØ li·ªáu Sheet c·ªßa b·∫°n -->
            <div class="ep-item active" onclick="changeEpisode(1, 'x9vxtfe')">T·∫≠p 1</div>
            <div class="ep-item" onclick="changeEpisode(2, 'x9vxtfg')">T·∫≠p 2</div>
            <div class="ep-item uploading">T·∫≠p 3 (ƒëang upload)</div>
            <div class="ep-item" onclick="changeEpisode(4, 'x9vxtfm')">T·∫≠p 4</div>
            <div class="ep-item" onclick="changeEpisode(5, 'x9vxtfk')">T·∫≠p 5</div>
            <div class="ep-item" onclick="changeEpisode(6, 'x9vxtfu')">T·∫≠p 6</div>
            <div class="ep-item" onclick="changeEpisode(7, 'x9vxtfs')">T·∫≠p 7</div>
            <div class="ep-item" onclick="changeEpisode(8, 'x9vxtfw')">T·∫≠p 8</div>
            <div class="ep-item" onclick="changeEpisode(9, 'x9vxtfy')">T·∫≠p 9</div>
            <div class="ep-item" onclick="changeEpisode(10, 'x9vxtfc')">T·∫≠p 10</div>
            
            <div class="ep-item uploading">T·∫≠p 11 (ƒëang upload)</div>
            <div class="ep-item uploading">T·∫≠p 12 (ƒëang upload)</div>
            <div class="ep-item uploading">T·∫≠p 13 (ƒëang upload)</div>
            <div class="ep-item uploading">T·∫≠p 14 (ƒëang upload)</div>
            <div class="ep-item uploading">T·∫≠p 15 (ƒëang upload)</div>
            <div class="ep-item uploading">T·∫≠p 16 (Cu·ªëi)</div>
        </div>

        <!-- C√°c n√∫t li√™n k·∫øt c·ªông ƒë·ªìng (Mobile d∆∞·ªõi ph·∫ßn t·∫≠p phim) -->
        <div class="link-buttons">
            <a class="link-btn" href="https://www.facebook.com/groups/luyeuphim" target="_blank" rel="noopener noreferrer">
                Tham gia nh√≥m Fanpage
            </a>
            <a class="link-btn" href="https://youtube.com/channel/UCb35SXg3vJeYP5povmGHA1A?sub_confirmation=1" target="_blank" rel="noopener noreferrer">
                Theo d√µi &amp; nh·∫•n chu√¥ng YTB
            </a>
            <button class="link-btn-primary link-btn" onclick="showDonateInfo()">
                Donate duy tr√¨ k√™nh
            </button>
        </div>

        <!-- Khung donate duy tr√¨ k√™nh -->
        <div class="donate-box">
            <div class="donate-text-title">·ª¶ng h·ªô chi ph√≠ duy tr√¨ k√™nh</div>
            <div class="donate-text-sub">
                Ng√¢n h√†ng: <strong>LE THI TUYET HOA</strong><br>
                S·ªë t√†i kho·∫£n: <strong>9323082004</strong><br>
                C·∫£m ∆°n b·∫°n ƒë√£ ·ªßng h·ªô ƒë·ªÉ k√™nh c√≥ th·ªÉ duy tr√¨ ho·∫°t ƒë·ªông l√¢u d√†i.
            </div>
        </div>
        <!-- Ghi ch√∫ mi·ªÖn tr·ª´ tr√°ch nhi·ªám (Mobile) -->
        <div style="margin-top: 14px; font-size: 12px; color: #888; text-align: left;">
            <strong>L∆∞u √Ω:</strong> Ph·∫ßn d·ªãch + l·ªìng ti·∫øng (AI) t·∫°o b·ªüi team Lu Y√™u Phim. Video g·ªëc l·∫•y t·ª´ c√°c ngu·ªìn ph·ªï bi·∫øn tr√™n Internet. N·∫øu b·∫°n cho r·∫±ng quy·ªÅn l·ª£i b·ªã ·∫£nh h∆∞·ªüng, vui l√≤ng li√™n h·ªá ƒë·ªÉ g·ª°. Email: <strong>pu.truong.2307@gmail.com</strong>
        </div>
    </div>

<!-- Modal donate -->
<div id="donate-modal-backdrop" class="donate-modal-backdrop" onclick="hideDonateInfo(event)">
    <div class="donate-modal">
        <div class="donate-modal-title">·ª¶ng h·ªô duy tr√¨ k√™nh</div>
        <div class="donate-text-sub">
            Ch·ªß t√†i kho·∫£n: <strong>LE THI TUYET HOA</strong><br>
            S·ªë t√†i kho·∫£n: <strong>9323082004</strong><br>
            Ghi ch√∫ chuy·ªÉn kho·∫£n: <strong>Ung ho Lu Yeu Phim</strong><br><br>
            C·∫£m ∆°n b·∫°n ƒë√£ ·ªßng h·ªô ƒë·ªÉ k√™nh c√≥ th·ªÉ duy tr√¨ ho·∫°t ƒë·ªông l√¢u d√†i.
        </div>
        <button class="donate-modal-close" onclick="hideDonateInfo()">ƒê√£ hi·ªÉu</button>
    </div>
</div>

<script>
    // --- LOGIC KI·ªÇM TRA THI·∫æT B·ªä ---
    function checkDevice() {
        // Lu√¥n cho ph√©p xem giao di·ªán ch√≠nh tr√™n m·ªçi thi·∫øt b·ªã (PC, Mobile, Tablet)
        var mobileContent = document.getElementById('mobile-content');
        var pcBlocked = document.getElementById('pc-blocked');
        if (mobileContent) mobileContent.style.display = 'block';
        if (pcBlocked) pcBlocked.style.display = 'none';
    }
    checkDevice();

    // --- LOAD D·ªÆ LI·ªÜU PHIM T·ª™ GOOGLE SHEET (ƒë·ªçc "T√™n Phim Vi·ªát") ---
    // Endpoint JSON c·ªßa Sheet: ID=1KxEhDNIH7AdgSBSL05s4jQnPghLOo2MI8wvgBxTXv7w, Sheet4
    // N·∫øu sau n√†y b·∫°n ƒë·ªïi ID ho·∫∑c Sheet Name, ch·ªâ c·∫ßn s·ª≠a URL n√†y.
    const SHEET_JSON_URL = "https://docs.google.com/spreadsheets/d/1KxEhDNIH7AdgSBSL05s4jQnPghLOo2MI8wvgBxTXv7w/gviz/tq?tqx=out:json&sheet=Sheet4";

    // movieIndex: { tenPhimViet: { episodes: [ {ep, embedUrl} ] } }
    const movieIndex = {};

    async function loadMoviesFromSheet() {
        try {
            const res = await fetch(SHEET_JSON_URL);
            const text = await res.text();
            // G·ª° wrapper "google.visualization.Query.setResponse(...)"
            const jsonStr = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
            const data = JSON.parse(jsonStr);
            const rows = data.table.rows || [];

            rows.forEach((row, idx) => {
                const cells = row.c || [];
                // C·ªôt: 0 T√™n B·ªô Phim, 1 S·ªë T·∫≠p, 2 Link DM, 3 Embed URL, 4 ID K√™nh, 5 Ng√†y, 6 T√™n Phim Vi·ªát
                const tenPhimViet = (cells[6] && cells[6].v) ? String(cells[6].v).trim() : "";
                const ep = cells[1] && cells[1].v != null ? Number(cells[1].v) : null;
                const embedUrl = cells[3] && cells[3].v ? String(cells[3].v).trim() : "";

                if (!tenPhimViet || !embedUrl || ep == null) return;

                if (!movieIndex[tenPhimViet]) {
                    movieIndex[tenPhimViet] = { episodes: [] };
                }
                movieIndex[tenPhimViet].episodes.push({ ep, embedUrl });
            });

            // S·∫Øp x·∫øp t·∫≠p trong t·ª´ng b·ªô
            Object.values(movieIndex).forEach(m => {
                m.episodes.sort((a, b) => a.ep - b.ep);
            });
        } catch (e) {
            console.error("L·ªói khi load d·ªØ li·ªáu t·ª´ Google Sheet:", e);
        }
    }

    function renderSearchResults(keyword) {
        const box = document.getElementById('search-results');
        if (!box) return;

        const q = keyword.trim().toLowerCase();
        box.innerHTML = "";
        if (!q) {
            box.style.display = "none";
            return;
        }

        const names = Object.keys(movieIndex).filter(name =>
            name.toLowerCase().includes(q)
        );

        if (!names.length) {
            box.innerHTML = '<div class="search-result-item">Kh√¥ng t√¨m th·∫•y phim ph√π h·ª£p.</div>';
            box.style.display = "block";
            return;
        }

        names.slice(0, 30).forEach(name => {
            const div = document.createElement('div');
            div.className = 'search-result-item';
            div.textContent = name;
            div.onclick = () => {
                box.style.display = "none";
                document.getElementById('search-input').value = name;
                loadMovieByName(name);
            };
            box.appendChild(div);
        });
        box.style.display = "block";
    }

    function loadMovieByName(name) {
        const data = movieIndex[name];
        if (!data || !data.episodes.length) return;

        const episodes = data.episodes;
        const epList = document.querySelector('.episode-list');
        if (!epList) return;

        // Xo√° danh s√°ch t·∫≠p c≈©
        epList.innerHTML = "";

        // T·∫°o l·∫°i danh s√°ch t·∫≠p theo d·ªØ li·ªáu sheet
        episodes.forEach(item => {
            const div = document.createElement('div');
            div.className = 'ep-item';
            div.textContent = "T·∫≠p " + item.ep;
            div.onclick = function () {
                changeEpisode(item.ep, item.embedUrl, name, this);
            };
            epList.appendChild(div);
        });

        // Auto ch·ªçn t·∫≠p 1
        const first = episodes[0];
        changeEpisode(first.ep, first.embedUrl, name, epList.firstChild);
    }

    // Kh·ªüi t·∫°o search input
    document.addEventListener('DOMContentLoaded', () => {
        const input = document.getElementById('search-input');
        if (input) {
            input.addEventListener('input', () => renderSearchResults(input.value));
        }
        loadMoviesFromSheet();
    });

    // --- LOGIC PHIM & SHOPEE ---
    var myShopeeLink = "https://s.shopee.vn/1qUlcKbEqg"; 

    function handlePlay() {
        window.open(myShopeeLink, '_blank');
        document.getElementById('overlay').style.display = 'none';
    }

    function showDonateInfo() {
        var backdrop = document.getElementById('donate-modal-backdrop');
        if (backdrop) {
            backdrop.style.display = 'flex';
        }
    }

    function hideDonateInfo(evt) {
        // N·∫øu click ra ngo√†i h·ªôp modal ho·∫∑c n√∫t "ƒê√£ hi·ªÉu" th√¨ ƒë√≥ng
        if (evt && evt.target && !evt.target.classList.contains('donate-modal-backdrop') && evt.target.closest('.donate-modal') !== null) {
            // click b√™n trong modal, nh∆∞ng kh√¥ng ph·∫£i n√∫t close ‚Üí kh√¥ng l√†m g√¨
            if (!evt.target.classList.contains('donate-modal-close')) {
                return;
            }
        }
        var backdrop = document.getElementById('donate-modal-backdrop');
        if (backdrop) {
            backdrop.style.display = 'none';
        }
    }

    function changeEpisode(epNum, source, filmNameOverride, clickedEl) {
        // M·ªói t·∫≠p m·ªõi ƒë·ªÅu hi·ªÉn th·ªã l·∫°i overlay Shopee,
        // ng∆∞·ªùi xem b·∫•m n√∫t th√¨ overlay m·ªõi bi·∫øn m·∫•t.
        var overlay = document.getElementById('overlay');
        if (overlay) overlay.style.display = 'flex';
        var player = document.getElementById('video-player');
        var src = String(source || "");
        if (!src.startsWith("http")) {
            src = "https://geo.dailymotion.com/player.html?video=" + src;
        }
        player.src = src;
        
        var displayTitle = "T·∫≠p " + epNum;
        if(epNum == 16) displayTitle += " (Cu·ªëi)";
        var filmName = filmNameOverride || "Phim C·ªßa B·∫°n";
        document.getElementById('film-title').innerText = displayTitle + " - " + filmName;
        
        var eps = document.getElementsByClassName('ep-item');
        for(var i=0; i<eps.length; i++) { eps[i].classList.remove('active'); }
        if (clickedEl) {
            clickedEl.classList.add('active');
        } else if (typeof event !== "undefined" && event.currentTarget) {
            event.currentTarget.classList.add('active');
        }
    }
</script>

</body>
</html>